<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NioSports Pro - Sistema Completo</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Sistema profesional NBA con predicci√≥n, H2H y bankroll">
    <meta name="theme-color" content="#0d1b2a">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%230d1b2a'/%3E%3Ctext x='32' y='42' text-anchor='middle' font-size='30' fill='%23FFD700'%3EN%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <style>
        * { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        .font-display { font-family: 'Bebas Neue', sans-serif; letter-spacing: 2px; }
        
        :root {
            --navy-dark: #0a1628;
            --navy-primary: #0d1b2a;
            --navy-light: #1b263b;
            --navy-lighter: #22354a;
            --gold-primary: #FFD700;
            --gold-light: #FFEB3B;
            --gold-dark: #F59E0B;
            --white: #ffffff;
            --text-muted: #94a3b8;
        }
        
        body {
            background: var(--navy-dark);
            color: var(--white);
            min-height: 100vh;
        }
        
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            background: linear-gradient(180deg, var(--navy-dark) 0%, var(--navy-primary) 50%, var(--navy-light) 100%);
        }
        
        .glass {
            background: rgba(27, 38, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 215, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border-radius: 16px;
        }
        
        .glass-card {
            background: rgba(27, 38, 59, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border-radius: 16px;
        }
        
        .glass-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-light) 50%, var(--gold-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: var(--navy-dark);
            font-weight: 600;
            padding: 12px 28px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }
        
        .nav-tab {
            padding: 16px 32px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-weight: 600;
        }
        
        .nav-tab:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        .nav-tab.active {
            border-bottom-color: var(--gold-primary);
            background: rgba(255, 215, 0, 0.15);
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(30, 27, 75, 0.8) 0%, rgba(49, 46, 129, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            border-radius: 12px;
            padding: 20px;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 200, 255, 0.5);
        }
        
        .pick-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            border-radius: 12px;
            padding: 16px;
        }
        
        .pick-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 200, 255, 0.3);
        }
        
        .win-badge { background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 4px 12px; border-radius: 20px; color: white; font-size: 12px; font-weight: 600; }
        .loss-badge { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 4px 12px; border-radius: 20px; color: white; font-size: 12px; font-weight: 600; }
        .pending-badge { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 4px 12px; border-radius: 20px; color: white; font-size: 12px; font-weight: 600; }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        .score-input {
            background: #1a1a2e;
            border: 2px solid #4a4a6a;
            color: white;
            border-radius: 8px;
            padding: 8px;
        }
        
        .score-input:focus {
            border-color: #00c8ff;
            outline: none;
        }
        
        textarea {
            background: #1a1a2e;
            border: 2px solid #4a4a6a;
            color: white;
            border-radius: 8px;
            padding: 8px;
        }
        
        textarea:focus {
            border-color: #00c8ff;
            outline: none;
        }
        
        select {
            background: #1a1a2e;
            border: 2px solid #4a4a6a;
            color: white;
            border-radius: 8px;
            padding: 8px;
        }
        
        select:focus {
            border-color: #00c8ff;
            outline: none;
        }
        
        .firebase-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            font-weight: 600;
        }
        
        .firebase-connected { background: #22c55e; color: white; }
        .firebase-disconnected { background: #ef4444; color: white; }
        .firebase-loading { background: #f59e0b; color: white; }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div id="firebaseStatus" class="firebase-status firebase-loading">üîÑ Conectando...</div>
    
    <div class="container mx-auto px-4 py-8">
        <!-- Header & Navigation -->
        <div class="glass mb-8 overflow-hidden">
            <div class="p-6 border-b border-white/10">
                <h1 class="text-5xl font-display gradient-text text-center">NIOSPORTS PRO</h1>
                <p class="text-center text-gray-400 mt-2">Sistema Profesional Completo</p>
            </div>
            <div class="flex justify-center">
                <div onclick="switchView('predictor')" class="nav-tab active" id="tab-predictor">
                    üéØ Predictor NBA
                </div>
                <div onclick="switchView('h2h')" class="nav-tab" id="tab-h2h">
                    üìä Base H2H
                </div>
                <div onclick="switchView('bankroll')" class="nav-tab" id="tab-bankroll">
                    üí∞ Bankroll
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div id="content-area"></div>
    </div>
    
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FIREBASE CONFIG
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const firebaseConfig = {
            apiKey: "AIzaSyCpddyEiWIE6VBe5u8JRPYBHlnYRMgljCs",
            authDomain: "niosports-pro.firebaseapp.com",
            databaseURL: "https://niosports-pro-default-rtdb.firebaseio.com",
            projectId: "niosports-pro",
            storageBucket: "niosports-pro.firebasestorage.app",
            messagingSenderId: "669355459084",
            appId: "1:669355459084:web:6c11965f3940bae9c8a429"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        let firebaseConnected = false;
        
        database.ref('.info/connected').on('value', (snap) => {
            const el = document.getElementById('firebaseStatus');
            if (snap.val()) {
                el.textContent = 'üü¢ Firebase Conectado';
                el.className = 'firebase-status firebase-connected';
                firebaseConnected = true;
            } else {
                el.textContent = 'üî¥ Sin Conexi√≥n';
                el.className = 'firebase-status firebase-disconnected';
                firebaseConnected = false;
            }
        });
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DATA
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const TEAM_STATS = {
            "Nuggets": { fullHome: 126.1, fullAway: 125.5, full: 125.8, q1Home: 32.9, q1Away: 30.5, q1: 31.7, halfHome: 65.7, halfAway: 59.8, half: 62.4 },
            "Thunder": { fullHome: 121.8, fullAway: 120.8, full: 121.3, q1Home: 30.0, q1Away: 31.4, q1: 30.8, halfHome: 60.8, halfAway: 59.3, half: 60.0 },
            "Rockets": { fullHome: 121.2, fullAway: 120.1, full: 120.5, q1Home: 29.6, q1Away: 30.6, q1: 30.3, halfHome: 61.0, halfAway: 58.1, half: 59.3 },
            "Knicks": { fullHome: 123.1, fullAway: 117.1, full: 120.4, q1Home: 32.0, q1Away: 28.2, q1: 30.2, halfHome: 62.6, halfAway: 58.0, half: 60.8 },
            "Cavaliers": { fullHome: 118.1, fullAway: 123.2, full: 120.2, q1Home: 29.0, q1Away: 32.6, q1: 30.4, halfHome: 54.7, halfAway: 61.3, half: 57.4 },
            "Spurs": { fullHome: 120.4, fullAway: 119.8, full: 120.1, q1Home: 30.2, q1Away: 31.2, q1: 30.7, halfHome: 60.7, halfAway: 59.5, half: 60.1 },
            "Lakers": { fullHome: 121.1, fullAway: 114.0, full: 116.9, q1Home: 31.8, q1Away: 28.5, q1: 29.8, halfHome: 63.5, halfAway: 57.8, half: 60.4 },
            "Celtics": { fullHome: 118.6, fullAway: 113.2, full: 116.0, q1Home: 29.8, q1Away: 31.3, q1: 30.5, halfHome: 61.4, halfAway: 59.4, half: 60.4 },
            "Warriors": { fullHome: 118.3, fullAway: 111.5, full: 114.5, q1Home: 27.6, q1Away: 25.8, q1: 26.6, halfHome: 57.2, halfAway: 51.6, half: 54.0 },
            "Heat": { fullHome: 119.1, fullAway: 119.3, full: 119.2, q1Home: 28.9, q1Away: 34.0, q1: 31.5, halfHome: 62.1, halfAway: 65.5, half: 63.7 }
        };
        
        let H2H_DATABASE = {};
        let BANKROLL_DATA = {
            dailyBanks: {},
            picks: [],
            settings: { alertThreshold: 20, initialBank: 0 }
        };
        
        let currentView = 'predictor';
        let bankrollChart = null;
        let filterPeriod = 'all';
        let filterType = 'all';
        
        // H2H Variables
        let ingestTeam1 = '', ingestTeam2 = '', ingestLocalTeam = '', ingestDate = '';
        let ingestScores = {localQ1:'',localQ2:'',localQ3:'',localQ4:'',awayQ1:'',awayQ2:'',awayQ3:'',awayQ4:'',localOT1:'',awayOT1:'',localOT2:'',awayOT2:'',localOT3:'',awayOT3:''};
        
        // Predictor Variables
        let localTeam = '', visitingTeam = '';
        let lineQ1 = '', lineHalf = '', lineFull = '';
        let typeQ1 = 'OVER', typeHalf = 'OVER', typeFull = 'OVER';
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FIREBASE FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function loadH2HFromFirebase() {
            database.ref('h2h_games').on('value', (snapshot) => {
                if (snapshot.exists()) H2H_DATABASE = snapshot.val();
                if (currentView === 'h2h' || currentView === 'predictor') render();
            });
        }
        
        function loadBankrollFromFirebase() {
            database.ref('bankroll').on('value', (snapshot) => {
                if (snapshot.exists()) BANKROLL_DATA = snapshot.val();
                if (currentView === 'bankroll') render();
            });
        }
        
        function saveBankrollToFirebase() {
            if (!firebaseConnected) {
                alert('‚ö†Ô∏è No hay conexi√≥n con Firebase');
                return false;
            }
            database.ref('bankroll').set(BANKROLL_DATA);
            return true;
        }
        
        function addH2HGame(team1, team2, gameData) {
            const key = [team1, team2].sort().join('_');
            if (!H2H_DATABASE[key]) H2H_DATABASE[key] = [];
            H2H_DATABASE[key].push(gameData);
            database.ref('h2h_games/' + key).set(H2H_DATABASE[key]);
        }
        
        function deleteH2HGame(team1, team2, index) {
            const key = [team1, team2].sort().join('_');
            if (H2H_DATABASE[key]) {
                H2H_DATABASE[key].splice(index, 1);
                database.ref('h2h_games/' + key).set(H2H_DATABASE[key]);
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // BANKROLL FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        function canSetDailyBank() {
            return !BANKROLL_DATA.dailyBanks[getTodayDate()];
        }
        
        function setDailyBank(amount) {
            const today = getTodayDate();
            if (BANKROLL_DATA.dailyBanks[today]) {
                alert('‚ö†Ô∏è Ya has registrado el bank de hoy');
                return false;
            }
            BANKROLL_DATA.dailyBanks[today] = parseFloat(amount);
            if (BANKROLL_DATA.settings.initialBank === 0) {
                BANKROLL_DATA.settings.initialBank = parseFloat(amount);
            }
            saveBankrollToFirebase();
            render();
            return true;
        }
        
        function getCurrentBank() {
            const dates = Object.keys(BANKROLL_DATA.dailyBanks).sort();
            if (dates.length === 0) return 0;
            
            const latestDate = dates[dates.length - 1];
            let bank = BANKROLL_DATA.dailyBanks[latestDate];
            
            const picks = BANKROLL_DATA.picks.filter(p => p.date >= latestDate && p.status !== 'pending');
            picks.forEach(pick => {
                if (pick.status === 'won') bank += pick.profit;
                else if (pick.status === 'lost') bank -= pick.stake;
            });
            
            return bank;
        }
        
        function addPick(pickData) {
            const pick = {
                id: Date.now(),
                date: getTodayDate(),
                time: new Date().toLocaleTimeString('es-ES'),
                type: pickData.type,
                odds: parseFloat(pickData.odds),
                stake: parseFloat(pickData.stake),
                profit: (parseFloat(pickData.stake) * parseFloat(pickData.odds)) - parseFloat(pickData.stake),
                category: pickData.category || 'NBA',
                notes: pickData.notes || '',
                status: 'pending'
            };
            
            BANKROLL_DATA.picks.unshift(pick);
            saveBankrollToFirebase();
            render();
        }
        
        function updatePickStatus(pickId, status) {
            const pick = BANKROLL_DATA.picks.find(p => p.id === pickId);
            if (pick) {
                pick.status = status;
                saveBankrollToFirebase();
                render();
            }
        }
        
        function deletePick(pickId) {
            BANKROLL_DATA.picks = BANKROLL_DATA.picks.filter(p => p.id !== pickId);
            saveBankrollToFirebase();
            render();
        }
        
        function getFilteredPicks() {
            let picks = BANKROLL_DATA.picks.filter(p => p.status !== 'pending');
            
            if (filterPeriod !== 'all') {
                const today = new Date();
                const startDate = new Date();
                
                if (filterPeriod === 'today') startDate.setHours(0, 0, 0, 0);
                else if (filterPeriod === 'week') startDate.setDate(today.getDate() - 7);
                else if (filterPeriod === 'month') startDate.setMonth(today.getMonth() - 1);
                
                picks = picks.filter(p => new Date(p.date) >= startDate);
            }
            
            if (filterType !== 'all') picks = picks.filter(p => p.type === filterType);
            
            return picks;
        }
        
        function calculateStats() {
            const picks = getFilteredPicks();
            const totalPicks = picks.length;
            const wonPicks = picks.filter(p => p.status === 'won').length;
            const lostPicks = picks.filter(p => p.status === 'lost').length;
            
            const totalStaked = picks.reduce((sum, p) => sum + p.stake, 0);
            const totalProfit = picks.reduce((sum, p) => {
                return sum + (p.status === 'won' ? p.profit : -p.stake);
            }, 0);
            
            const strikeRate = totalPicks > 0 ? (wonPicks / totalPicks) * 100 : 0;
            const roi = totalStaked > 0 ? (totalProfit / totalStaked) * 100 : 0;
            const yield_ = totalPicks > 0 ? (totalProfit / totalStaked) * 100 : 0;
            const avgOdds = totalPicks > 0 ? picks.reduce((sum, p) => sum + p.odds, 0) / totalPicks : 0;
            
            let currentStreak = 0, streakType = 'none';
            for (let i = 0; i < picks.length; i++) {
                if (i === 0) {
                    currentStreak = 1;
                    streakType = picks[i].status;
                } else if (picks[i].status === streakType) {
                    currentStreak++;
                } else break;
            }
            
            let maxDrawdown = 0;
            const singlePicks = picks.filter(p => p.type === 'single');
            const comboPicks = picks.filter(p => p.type === 'combo');
            
            return {
                totalPicks, wonPicks, lostPicks, strikeRate, roi,
                yield: yield_, avgOdds, totalProfit, totalStaked,
                currentStreak, streakType, maxDrawdown,
                singlePicks, comboPicks,
                currentBank: getCurrentBank(),
                initialBank: BANKROLL_DATA.settings.initialBank
            };
        }
        
        function exportToCSV() {
            const picks = BANKROLL_DATA.picks;
            let csv = 'Fecha,Hora,Tipo,Cuota,Importe,Ganancia,Categor√≠a,Estado,Notas\n';
            picks.forEach(pick => {
                csv += `${pick.date},${pick.time},${pick.type},${pick.odds},${pick.stake},${pick.profit.toFixed(2)},${pick.category},${pick.status},${pick.notes}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bankroll_export_${getTodayDate()}.csv`;
            a.click();
        }
        
        function createBankrollChart() {
            const canvas = document.getElementById('bankrollChart');
            if (!canvas) return;
            
            if (bankrollChart) bankrollChart.destroy();
            
            const sortedDates = Object.keys(BANKROLL_DATA.dailyBanks).sort();
            const labels = [];
            const data = [];
            
            sortedDates.forEach(date => {
                let bank = BANKROLL_DATA.dailyBanks[date];
                const dayPicks = BANKROLL_DATA.picks.filter(p => p.date === date && p.status !== 'pending');
                dayPicks.forEach(pick => {
                    if (pick.status === 'won') bank += pick.profit;
                    else if (pick.status === 'lost') bank -= pick.stake;
                });
                labels.push(date);
                data.push(bank);
            });
            
            bankrollChart = new Chart(canvas.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Bank',
                        data: data,
                        borderColor: '#00c8ff',
                        backgroundColor: 'rgba(0, 200, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' } },
                        x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#fff' } }
                    }
                }
            });
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // H2H FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function calculateTrend(localTeam, visitingTeam, period, location) {
            const key = [localTeam, visitingTeam].sort().join('_');
            const games = H2H_DATABASE[key] || [];
            
            if (games.length === 0) {
                const lt = TEAM_STATS[localTeam];
                const vt = TEAM_STATS[visitingTeam];
                if (!lt || !vt) return { avg: 0, games: 0, record: 'N/A' };
                
                const propMap = { 'Q1': 'q1', 'Half': 'half', 'Full': 'full' };
                const locMap = { home: 'Home', away: 'Away', neutral: '' };
                const prop = propMap[period] + locMap[location];
                
                const avg = (lt[prop] + vt[location === 'home' ? prop.replace('Home','Away').replace('Away','Home') : prop]) / 2;
                return { avg: avg.toFixed(1), games: 0, record: 'Proyecci√≥n' };
            }
            
            const relevantGames = games.filter(g => {
                if (location === 'home') return g.localTeam === localTeam;
                if (location === 'away') return g.localTeam === visitingTeam;
                return true;
            });
            
            if (relevantGames.length === 0) return { avg: 0, games: 0, record: 'N/A' };
            
            let total = 0;
            relevantGames.forEach(g => {
                let sum = 0;
                if (period === 'Q1') sum = g.localQ1 + g.awayQ1;
                else if (period === 'Half') sum = g.localQ1 + g.localQ2 + g.awayQ1 + g.awayQ2;
                else {
                    sum = g.localQ1 + g.localQ2 + g.localQ3 + g.localQ4 + g.awayQ1 + g.awayQ2 + g.awayQ3 + g.awayQ4;
                    if (g.overtimes > 0) {
                        sum += (g.localOT1 || 0) + (g.awayOT1 || 0);
                        if (g.overtimes > 1) sum += (g.localOT2 || 0) + (g.awayOT2 || 0);
                        if (g.overtimes > 2) sum += (g.localOT3 || 0) + (g.awayOT3 || 0);
                    }
                }
                total += sum;
            });
            
            const avg = relevantGames.length > 0 ? total / relevantGames.length : 0;
            return {
                avg: avg.toFixed(1),
                games: relevantGames.length,
                record: `${relevantGames.length} juegos H2H`
            };
        }
        
        function getRecommendation(trend, line, type) {
            if (!trend || !line || trend.games === 0) return { text: 'Sin datos', class: 'text-gray-400', confidence: 0 };
            
            const diff = Math.abs(parseFloat(trend.avg) - parseFloat(line));
            const isOver = parseFloat(trend.avg) > parseFloat(line);
            
            let confidence = 0;
            if (diff >= 10) confidence = 95;
            else if (diff >= 7) confidence = 85;
            else if (diff >= 5) confidence = 75;
            else if (diff >= 3) confidence = 65;
            else confidence = 55;
            
            const recommended = isOver ? 'OVER' : 'UNDER';
            const isCorrect = recommended === type;
            
            return {
                text: `${recommended} (${confidence}%)`,
                class: isCorrect ? 'text-green-400' : 'text-red-400',
                confidence: confidence
            };
        }
        
        function getScores() {
            return {
                lQ1: parseInt(ingestScores.localQ1) || 0,
                lQ2: parseInt(ingestScores.localQ2) || 0,
                lQ3: parseInt(ingestScores.localQ3) || 0,
                lQ4: parseInt(ingestScores.localQ4) || 0,
                aQ1: parseInt(ingestScores.awayQ1) || 0,
                aQ2: parseInt(ingestScores.awayQ2) || 0,
                aQ3: parseInt(ingestScores.awayQ3) || 0,
                aQ4: parseInt(ingestScores.awayQ4) || 0,
                lOT1: parseInt(ingestScores.localOT1) || 0,
                aOT1: parseInt(ingestScores.awayOT1) || 0,
                lOT2: parseInt(ingestScores.localOT2) || 0,
                aOT2: parseInt(ingestScores.awayOT2) || 0,
                lOT3: parseInt(ingestScores.localOT3) || 0,
                aOT3: parseInt(ingestScores.awayOT3) || 0
            };
        }
        
        function updateTotals() {
            if (!ingestLocalTeam) return;
            const td = document.getElementById('totalsDisplay');
            if (!td) return;
            
            const s = getScores();
            const away = ingestLocalTeam === ingestTeam1 ? ingestTeam2 : ingestTeam1;
            const lH = s.lQ1 + s.lQ2, aH = s.aQ1 + s.aQ2;
            const lT = s.lQ1 + s.lQ2 + s.lQ3 + s.lQ4 + s.lOT1 + s.lOT2 + s.lOT3;
            const aT = s.aQ1 + s.aQ2 + s.aQ3 + s.aQ4 + s.aOT1 + s.aOT2 + s.aOT3;
            const hadOT = s.lOT1 > 0 || s.aOT1 > 0;
            
            let win = 'Empate', wc = 'text-gray-400';
            if (lT > aT) { win = ingestLocalTeam; wc = 'text-cyan-400'; }
            else if (aT > lT) { win = away; wc = 'text-orange-400'; }
            
            td.innerHTML = `
                <div class="bg-yellow-500/20 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs">1er Tiempo</p>
                    <p class="text-cyan-400 font-bold">${ingestLocalTeam}: ${lH}</p>
                    <p class="text-orange-400 font-bold">${away}: ${aH}</p>
                    <p class="text-yellow-400 font-black text-xl mt-1">Total: ${lH + aH}</p>
                </div>
                <div class="bg-purple-500/20 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs">Tiempo Completo${hadOT ? ' + OT' : ''}</p>
                    <p class="text-cyan-400 font-bold">${ingestLocalTeam}: ${lT}</p>
                    <p class="text-orange-400 font-bold">${away}: ${aT}</p>
                    <p class="text-purple-400 font-black text-xl mt-1">Total: ${lT + aT}</p>
                </div>
                <div class="bg-green-500/20 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs">Ganador${hadOT ? ' (OT)' : ''}</p>
                    <p class="text-3xl font-black ${wc}">${win}</p>
                    <p class="text-white font-bold">${lT}-${aT}</p>
                </div>
            `;
        }
        
        function saveGame() {
            if (!firebaseConnected) {
                alert('‚ö†Ô∏è No hay conexi√≥n con Firebase');
                return;
            }
            
            const di = document.getElementById('ingestDate');
            if (di) ingestDate = di.value;
            
            ['localQ1','localQ2','localQ3','localQ4','awayQ1','awayQ2','awayQ3','awayQ4','localOT1','awayOT1','localOT2','awayOT2','localOT3','awayOT3'].forEach(id => {
                const inp = document.getElementById(id);
                if (inp) ingestScores[id] = inp.value;
            });
            
            if (!ingestTeam1 || !ingestTeam2 || !ingestLocalTeam || !ingestDate) {
                alert('Completa todos los campos');
                return;
            }
            
            const s = getScores();
            const lT = s.lQ1 + s.lQ2 + s.lQ3 + s.lQ4 + s.lOT1 + s.lOT2 + s.lOT3;
            const aT = s.aQ1 + s.aQ2 + s.aQ3 + s.aQ4 + s.aOT1 + s.aOT2 + s.aOT3;
            
            if (lT === 0 || aT === 0) {
                alert('Ingresa los puntos');
                return;
            }
            if (lT === aT) {
                alert('‚ö†Ô∏è Empate. Ingresa Overtime.');
                return;
            }
            
            const away = ingestLocalTeam === ingestTeam1 ? ingestTeam2 : ingestTeam1;
            const [y, m, d] = ingestDate.split('-');
            const ms = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            const df = ms[parseInt(m) - 1] + ' ' + parseInt(d) + ', ' + y;
            
            let ots = 0;
            if (s.lOT1 > 0 || s.aOT1 > 0) ots = 1;
            if (s.lOT2 > 0 || s.aOT2 > 0) ots = 2;
            if (s.lOT3 > 0 || s.aOT3 > 0) ots = 3;
            
            addH2HGame(ingestTeam1, ingestTeam2, {
                date: df,
                localTeam: ingestLocalTeam,
                awayTeam: away,
                localQ1: s.lQ1, localQ2: s.lQ2, localQ3: s.lQ3, localQ4: s.lQ4,
                awayQ1: s.aQ1, awayQ2: s.aQ2, awayQ3: s.aQ3, awayQ4: s.aQ4,
                localOT1: s.lOT1, awayOT1: s.aOT1,
                localOT2: s.lOT2, awayOT2: s.aOT2,
                localOT3: s.lOT3, awayOT3: s.aOT3,
                overtimes: ots
            });
            
            ingestScores = {localQ1:'',localQ2:'',localQ3:'',localQ4:'',awayQ1:'',awayQ2:'',awayQ3:'',awayQ4:'',localOT1:'',awayOT1:'',localOT2:'',awayOT2:'',localOT3:'',awayOT3:''};
            ingestDate = '';
            ingestLocalTeam = '';
            alert('‚úÖ ¬°Guardado en Firebase!');
            render();
        }
        
        function deleteGame(t1, t2, i) {
            if (confirm('¬øEliminar este partido de Firebase?')) {
                deleteH2HGame(t1, t2, i);
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // RENDER FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function renderPredictor() {
            const teams = Object.keys(TEAM_STATS).sort();
            const teamOpts = teams.map(t => `<option value="${t}">${t}</option>`).join('');
            const trendQ1 = localTeam && visitingTeam ? calculateTrend(localTeam, visitingTeam, 'Q1', 'neutral') : null;
            const trendHalf = localTeam && visitingTeam ? calculateTrend(localTeam, visitingTeam, 'Half', 'neutral') : null;
            const trendFull = localTeam && visitingTeam ? calculateTrend(localTeam, visitingTeam, 'Full', 'neutral') : null;
            const recQ1 = trendQ1 && lineQ1 ? getRecommendation(trendQ1, lineQ1, typeQ1) : null;
            const recHalf = trendHalf && lineHalf ? getRecommendation(trendHalf, lineHalf, typeHalf) : null;
            const recFull = trendFull && lineFull ? getRecommendation(trendFull, lineFull, typeFull) : null;
            
            const key = localTeam && visitingTeam ? [localTeam, visitingTeam].sort().join('_') : '';
            const h2hGames = key ? (H2H_DATABASE[key] || []) : [];
            
            return `
                <div class="glass p-6 mb-6">
                    <h2 class="text-3xl font-bold text-white mb-4">üéØ Predictor de Totales NBA</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Equipo Local</label>
                            <select id="localSelect" class="w-full px-4 py-3 rounded-lg" onchange="localTeam=this.value;render()">
                                <option value="">Seleccionar...</option>
                                ${teamOpts}
                            </select>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Equipo Visitante</label>
                            <select id="visitingSelect" class="w-full px-4 py-3 rounded-lg" onchange="visitingTeam=this.value;render()">
                                <option value="">Seleccionar...</option>
                                ${teamOpts}
                            </select>
                        </div>
                    </div>
                </div>
                
                ${localTeam && visitingTeam ? `
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        ${[
                            { title: '1Q', period: 'Q1', line: lineQ1, type: typeQ1, trend: trendQ1, rec: recQ1 },
                            { title: '1H', period: 'Half', line: lineHalf, type: typeHalf, trend: trendHalf, rec: recHalf },
                            { title: 'FULL', period: 'Full', line: lineFull, type: typeFull, trend: trendFull, rec: recFull }
                        ].map(item => `
                            <div class="glass-card p-6">
                                <h3 class="text-3xl font-display gradient-text text-center mb-4">${item.title}</h3>
                                <div class="flex gap-2 mb-4">
                                    <button onclick="setType('${item.period}','OVER')" class="flex-1 py-2 rounded-lg font-bold ${item.type === 'OVER' ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400'}">
                                        OVER
                                    </button>
                                    <button onclick="setType('${item.period}','UNDER')" class="flex-1 py-2 rounded-lg font-bold ${item.type === 'UNDER' ? 'bg-red-500 text-white' : 'bg-gray-700 text-gray-400'}">
                                        UNDER
                                    </button>
                                </div>
                                <input type="number" step="0.5" placeholder="L√≠nea" value="${item.line}" 
                                       onchange="updateLine('${item.period}', this.value)" 
                                       class="w-full px-4 py-3 score-input rounded-lg text-white font-bold text-center text-xl mb-4">
                                ${item.trend ? `
                                    <div class="bg-black/30 rounded-lg p-4 mb-3">
                                        <p class="text-gray-400 text-sm mb-1">Promedio H2H</p>
                                        <p class="text-cyan-400 font-bold text-2xl">${item.trend.avg}</p>
                                        <p class="text-gray-500 text-xs">${item.trend.record}</p>
                                    </div>
                                ` : ''}
                                ${item.rec ? `
                                    <div class="bg-black/30 rounded-lg p-4">
                                        <p class="text-gray-400 text-sm mb-1">Recomendaci√≥n</p>
                                        <p class="${item.rec.class} font-bold text-xl">${item.rec.text}</p>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="glass p-6">
                        <h3 class="text-2xl font-bold text-white mb-4">üìä Historial H2H (${h2hGames.length} partidos)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            ${h2hGames.length > 0 ? h2hGames.map(g => `
                                <div class="bg-slate-800/50 rounded-lg p-3">
                                    <p class="text-cyan-400 font-bold">${g.date}</p>
                                    <p class="text-white">${g.localTeam} ${g.localQ1 + g.localQ2 + g.localQ3 + g.localQ4} - ${g.awayTeam} ${g.awayQ1 + g.awayQ2 + g.awayQ3 + g.awayQ4}</p>
                                    <p class="text-gray-400 text-sm">1Q: ${g.localQ1 + g.awayQ1} | 1H: ${g.localQ1 + g.localQ2 + g.awayQ1 + g.awayQ2}</p>
                                </div>
                            `).join('') : '<p class="text-gray-400 col-span-2 text-center py-8">No hay datos H2H. Usa la secci√≥n Base H2H para agregar partidos.</p>'}
                        </div>
                    </div>
                ` : ''}
            `;
        }
        
        function renderH2H() {
            const teams = Object.keys(TEAM_STATS).sort();
            const teamOpts = teams.map(t => `<option value="${t}">${t}</option>`).join('');
            const showForm = ingestTeam1 && ingestTeam2;
            const key = ingestTeam1 && ingestTeam2 ? [ingestTeam1, ingestTeam2].sort().join('_') : '';
            const existingGames = key ? (H2H_DATABASE[key] || []) : [];
            
            return `
                <div class="glass p-6 mb-6">
                    <h2 class="text-3xl font-bold text-white mb-4">üìä Agregar Partido H2H</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Equipo 1</label>
                            <select id="ingestTeam1" onchange="ingestTeam1=this.value;ingestLocalTeam='';render()" class="w-full px-4 py-3 rounded-lg">
                                <option value="">Seleccionar...</option>
                                ${teamOpts}
                            </select>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Equipo 2</label>
                            <select id="ingestTeam2" onchange="ingestTeam2=this.value;ingestLocalTeam='';render()" class="w-full px-4 py-3 rounded-lg">
                                <option value="">Seleccionar...</option>
                                ${teamOpts}
                            </select>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Fecha</label>
                            <input type="date" id="ingestDate" value="${ingestDate}" onchange="ingestDate=this.value" class="w-full px-4 py-3 rounded-lg">
                        </div>
                    </div>
                    
                    ${showForm ? `
                        <div class="mb-4">
                            <label class="text-gray-400 text-sm block mb-2">¬øQui√©n fue Local?</label>
                            <div class="flex gap-4">
                                <button onclick="ingestLocalTeam='${ingestTeam1}';render()" 
                                        class="flex-1 py-3 rounded-lg font-bold ${ingestLocalTeam === ingestTeam1 ? 'bg-cyan-500 text-white' : 'bg-gray-700 text-gray-400'}">
                                    ${ingestTeam1}
                                </button>
                                <button onclick="ingestLocalTeam='${ingestTeam2}';render()" 
                                        class="flex-1 py-3 rounded-lg font-bold ${ingestLocalTeam === ingestTeam2 ? 'bg-orange-500 text-white' : 'bg-gray-700 text-gray-400'}">
                                    ${ingestTeam2}
                                </button>
                            </div>
                        </div>
                        
                        ${ingestLocalTeam ? `
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                                ${['Q1', 'Q2', 'Q3', 'Q4'].map(q => `
                                    <div>
                                        <p class="text-gray-400 text-sm mb-2">${ingestLocalTeam} ${q}</p>
                                        <input type="number" id="local${q}" value="${ingestScores['local'+q]}" 
                                               oninput="ingestScores.local${q}=this.value;updateTotals()"
                                               class="w-full px-3 py-2 score-input rounded-lg text-cyan-400 font-bold text-center">
                                    </div>
                                `).join('')}
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                                ${['Q1', 'Q2', 'Q3', 'Q4'].map(q => `
                                    <div>
                                        <p class="text-gray-400 text-sm mb-2">${ingestLocalTeam === ingestTeam1 ? ingestTeam2 : ingestTeam1} ${q}</p>
                                        <input type="number" id="away${q}" value="${ingestScores['away'+q]}"
                                               oninput="ingestScores.away${q}=this.value;updateTotals()"
                                               class="w-full px-3 py-2 score-input rounded-lg text-orange-400 font-bold text-center">
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div id="totalsDisplay" class="grid grid-cols-3 gap-4 mb-4"></div>
                            
                            <button onclick="saveGame()" class="w-full py-4 btn-primary text-lg">
                                ‚úÖ Guardar Partido en Firebase
                            </button>
                        ` : ''}
                    ` : ''}
                </div>
                
                ${existingGames.length > 0 ? `
                    <div class="glass p-6">
                        <h3 class="text-2xl font-bold text-white mb-4">Partidos Guardados (${existingGames.length})</h3>
                        <div class="space-y-3">
                            ${existingGames.map((g, i) => `
                                <div class="bg-slate-800/50 rounded-lg p-4 flex justify-between items-center">
                                    <div>
                                        <p class="text-cyan-400 font-bold">${g.date}</p>
                                        <p class="text-white text-lg">${g.localTeam} vs ${g.awayTeam}</p>
                                        <p class="text-gray-400">Final: ${g.localQ1 + g.localQ2 + g.localQ3 + g.localQ4} - ${g.awayQ1 + g.awayQ2 + g.awayQ3 + g.awayQ4}</p>
                                    </div>
                                    <button onclick="deleteGame('${ingestTeam1}', '${ingestTeam2}', ${i})" 
                                            class="px-4 py-2 bg-red-600 rounded-lg text-white font-bold hover:bg-red-700">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }
        
        function renderBankroll() {
            const stats = calculateStats();
            const canSetBank = canSetDailyBank();
            
            return `
                <div class="glass p-8 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-lg mb-2">Bank Actual</p>
                            <p class="text-6xl font-display gradient-text">$${stats.currentBank.toFixed(2)}</p>
                            <p class="text-${stats.totalProfit >= 0 ? 'green' : 'red'}-400 text-2xl mt-2">
                                ${stats.totalProfit >= 0 ? '+' : ''}$${stats.totalProfit.toFixed(2)}
                            </p>
                        </div>
                        <div class="text-right">
                            ${canSetBank ? `
                                <button onclick="showSetBankModal()" class="px-6 py-3 btn-primary mb-3">
                                    üìù Registrar Bank de Hoy
                                </button>
                            ` : `
                                <p class="text-green-400 text-lg mb-3">‚úÖ Bank registrado hoy</p>
                            `}
                            <button onclick="showAddPickModal()" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg text-white font-bold">
                                ‚ûï Agregar Pick
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="glass p-4 mb-6">
                    <div class="flex gap-4 items-center">
                        <select onchange="filterPeriod=this.value;render()" class="px-4 py-2 rounded-lg">
                            <option value="all">Todo el tiempo</option>
                            <option value="today">Hoy</option>
                            <option value="week">Esta semana</option>
                            <option value="month">Este mes</option>
                        </select>
                        <select onchange="filterType=this.value;render()" class="px-4 py-2 rounded-lg">
                            <option value="all">Todos los tipos</option>
                            <option value="single">Sencillas</option>
                            <option value="combo">Combinadas</option>
                        </select>
                        <button onclick="exportToCSV()" class="ml-auto px-4 py-2 bg-green-600 rounded-lg text-white font-bold">
                            üì• Exportar CSV
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                    <div class="stat-card">
                        <p class="text-gray-400 text-sm mb-1">ROI</p>
                        <p class="text-3xl font-bold text-${stats.roi >= 0 ? 'green' : 'red'}-400">${stats.roi.toFixed(1)}%</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-gray-400 text-sm mb-1">Yield</p>
                        <p class="text-3xl font-bold text-cyan-400">${stats.yield.toFixed(1)}%</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-gray-400 text-sm mb-1">Strike Rate</p>
                        <p class="text-3xl font-bold text-purple-400">${stats.strikeRate.toFixed(1)}%</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-gray-400 text-sm mb-1">Cuota Avg</p>
                        <p class="text-3xl font-bold text-yellow-400">${stats.avgOdds.toFixed(2)}</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-gray-400 text-sm mb-1">Racha Actual</p>
                        <p class="text-2xl font-bold text-${stats.streakType === 'won' ? 'green' : 'red'}-400">
                            ${stats.currentStreak}${stats.streakType === 'won' ? 'W' : stats.streakType === 'lost' ? 'L' : ''}
                        </p>
                    </div>
                    <div class="stat-card">
                        <p class="text-gray-400 text-sm mb-1">Total Picks</p>
                        <p class="text-3xl font-bold text-white">${stats.totalPicks}</p>
                    </div>
                </div>
                
                <div class="glass p-6 mb-6">
                    <h3 class="text-2xl font-bold text-white mb-4">üìà Evoluci√≥n del Bank</h3>
                    <div style="height: 300px;">
                        <canvas id="bankrollChart"></canvas>
                    </div>
                </div>
                
                <div class="glass p-6">
                    <h3 class="text-2xl font-bold text-white mb-4">üìã Picks Recientes</h3>
                    <div class="space-y-3">
                        ${BANKROLL_DATA.picks.slice(0, 10).map(pick => `
                            <div class="pick-card">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="${pick.status === 'won' ? 'win-badge' : pick.status === 'lost' ? 'loss-badge' : 'pending-badge'}">
                                                ${pick.status === 'won' ? '‚úÖ WON' : pick.status === 'lost' ? '‚ùå LOST' : '‚è≥ PENDIENTE'}
                                            </span>
                                            <span class="text-cyan-400 font-bold">${pick.type === 'single' ? 'üéØ Sencilla' : 'üé≤ Combinada'}</span>
                                            <span class="text-purple-400">${pick.category}</span>
                                        </div>
                                        <div class="grid grid-cols-4 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-400">Fecha</p>
                                                <p class="text-white">${pick.date} ${pick.time}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400">Cuota</p>
                                                <p class="text-yellow-400 font-bold">${pick.odds.toFixed(2)}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400">Stake</p>
                                                <p class="text-white font-bold">$${pick.stake.toFixed(2)}</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-400">Ganancia Potencial</p>
                                                <p class="text-green-400 font-bold">$${pick.profit.toFixed(2)}</p>
                                            </div>
                                        </div>
                                        ${pick.notes ? `<p class="text-gray-400 text-sm mt-2">üìù ${pick.notes}</p>` : ''}
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        ${pick.status === 'pending' ? `
                                            <button onclick="updatePickStatus(${pick.id}, 'won')" class="px-4 py-2 bg-green-600 rounded-lg text-white font-bold">
                                                ‚úÖ
                                            </button>
                                            <button onclick="updatePickStatus(${pick.id}, 'lost')" class="px-4 py-2 bg-red-600 rounded-lg text-white font-bold">
                                                ‚ùå
                                            </button>
                                        ` : ''}
                                        <button onclick="deletePick(${pick.id})" class="px-4 py-2 bg-gray-600 rounded-lg text-white font-bold">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function render() {
            const content = document.getElementById('content-area');
            
            if (currentView === 'predictor') {
                content.innerHTML = renderPredictor();
                document.getElementById('localSelect').value = localTeam;
                document.getElementById('visitingSelect').value = visitingTeam;
            } else if (currentView === 'h2h') {
                content.innerHTML = renderH2H();
                if (ingestTeam1) document.getElementById('ingestTeam1').value = ingestTeam1;
                if (ingestTeam2) document.getElementById('ingestTeam2').value = ingestTeam2;
                updateTotals();
            } else if (currentView === 'bankroll') {
                content.innerHTML = renderBankroll();
                setTimeout(() => createBankrollChart(), 100);
            }
        }
        
        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('tab-' + view).classList.add('active');
            render();
        }
        
        function setType(p, v) {
            if (p === 'Q1') typeQ1 = v;
            if (p === 'Half') typeHalf = v;
            if (p === 'Full') typeFull = v;
            render();
        }
        
        function updateLine(p, v) {
            if (p === 'Q1') lineQ1 = v;
            if (p === 'Half') lineHalf = v;
            if (p === 'Full') lineFull = v;
            render();
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MODALS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function showSetBankModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass rounded-xl p-8 max-w-md w-full mx-4">
                    <h3 class="text-2xl font-bold text-white mb-4">Registrar Bank de Hoy</h3>
                    <input type="number" id="bankInput" step="0.01" placeholder="$0.00" 
                           class="w-full px-4 py-3 score-input rounded-lg text-white font-bold text-center text-2xl mb-4">
                    <div class="flex gap-4">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 py-3 bg-gray-600 rounded-lg text-white font-bold">
                            Cancelar
                        </button>
                        <button onclick="setDailyBank(document.getElementById('bankInput').value);this.closest('.fixed').remove()" 
                                class="flex-1 py-3 bg-green-600 rounded-lg text-white font-bold">
                            Guardar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showAddPickModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 overflow-y-auto';
            modal.innerHTML = `
                <div class="glass rounded-xl p-8 max-w-2xl w-full mx-4 my-8">
                    <h3 class="text-2xl font-bold text-white mb-4">Agregar Nuevo Pick</h3>
                    
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Tipo de Apuesta</label>
                            <select id="pickType" class="w-full px-4 py-3 rounded-lg">
                                <option value="single">üéØ Sencilla</option>
                                <option value="combo">üé≤ Combinada</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Cuota</label>
                                <input type="number" id="pickOdds" step="0.01" placeholder="2.00" 
                                       class="w-full px-4 py-3 score-input rounded-lg text-white font-bold">
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Importe ($)</label>
                                <input type="number" id="pickStake" step="0.01" placeholder="100.00" 
                                       class="w-full px-4 py-3 score-input rounded-lg text-white font-bold">
                            </div>
                        </div>
                        
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Categor√≠a</label>
                            <select id="pickCategory" class="w-full px-4 py-3 rounded-lg">
                                <option value="NBA">üèÄ NBA</option>
                                <option value="NFL">üèà NFL</option>
                                <option value="F√∫tbol">‚öΩ F√∫tbol</option>
                                <option value="MLB">‚öæ MLB</option>
                                <option value="NHL">üèí NHL</option>
                                <option value="Otro">üé≤ Otro</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Notas (opcional)</label>
                            <textarea id="pickNotes" rows="3" placeholder="An√°lisis, raz√≥n del pick, etc." 
                                      class="w-full px-4 py-3 rounded-lg text-white"></textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 py-3 bg-gray-600 rounded-lg text-white font-bold">
                            Cancelar
                        </button>
                        <button onclick="submitPick();this.closest('.fixed').remove()" 
                                class="flex-1 py-3 bg-purple-600 rounded-lg text-white font-bold">
                            Agregar Pick
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function submitPick() {
            const type = document.getElementById('pickType').value;
            const odds = document.getElementById('pickOdds').value;
            const stake = document.getElementById('pickStake').value;
            const category = document.getElementById('pickCategory').value;
            const notes = document.getElementById('pickNotes').value;
            
            if (!odds || !stake || parseFloat(odds) <= 0 || parseFloat(stake) <= 0) {
                alert('Por favor completa todos los campos correctamente');
                return;
            }
            
            addPick({ type, odds, stake, category, notes });
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INITIALIZE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        document.addEventListener('DOMContentLoaded', () => {
            loadH2HFromFirebase();
            loadBankrollFromFirebase();
            render();
        });
    </script>
</body>
</html>
